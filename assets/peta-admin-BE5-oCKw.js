import"./flyonui-KD5sQRfT.js";import{l as p,t as T,c as M,s as w,a as P}from"./api-B-mpMLfD.js";const e={map:null,layerControl:null,merbungBoundary:null,dusunMerbungBoundary:null,dusunKrapyakBoundary:null,allMerbungData:null,allKrapyakData:null,allPerumData:null,merbungLayer:null,krapyakPerumLayer:null,searchTerm:"",searchTimeout:null,visibleLayers:{},categories:[],colors:{Merbung:{base:"rgba(219, 195, 13, 0.2)",hover:"rgba(219, 175, 13, 0.7)",solid:"rgb(219, 175, 13)"},"Krapyak & Perum":{base:"rgba(13, 157, 219, 0.15)",hover:"rgba(13, 157, 219, 0.7)",solid:"rgb(13, 157, 219)"}},routing:{control:null,startMarker:null,endMarker:null,startPoint:null,endPoint:null,selectingStart:!1,selectingEnd:!1,markericon:p.icon({iconUrl:"/images/maps/marker-icon.png"})}};async function R(){await x(),D(),I(),C(),S(),$(),E(),k()}async function x(){try{const[t,n,r,o,u,a]=await Promise.all([fetch("/data/merbung.geojson"),fetch("/data/rtrwmerbung.geojson"),fetch("/data/rtrwkrapyak.geojson"),fetch("/data/rtrwperum.geojson"),fetch("/data/dusun-merbung-region.geojson"),fetch("/data/dusun-krapyak-region.geojson")]);e.merbungBoundary=await t.json(),e.dusunMerbungBoundary=await u.json(),e.dusunKrapyakBoundary=await a.json(),e.allMerbungData=await n.json(),e.allKrapyakData=await r.json(),e.allPerumData=await o.json()}catch(t){console.error("Failed to load GeoJSON data:",t)}}function D(){const t=[...e.allMerbungData.features,...e.allKrapyakData.features,...e.allPerumData.features],n=new Set(t.map(o=>o.properties.RW)),r=Array.from(n).sort((o,u)=>o-u);e.categories=r.map(o=>({name:`RW ${String(o).padStart(2,"0")}`,value:o,isActive:!0}))}function I(){if(e.map=p.map("map"),T.OpenStreetMap.addTo(e.map),e.layerControl=p.control.layers(T,{}).addTo(e.map),e.merbungBoundary){const t=p.geoJSON(e.merbungBoundary,{style:{color:"red",weight:3,fillOpacity:0,interactive:!1}}).addTo(e.map);e.map.fitBounds(t.getBounds()),e.layerControl.addOverlay(t,"Batas Desa")}if(e.dusunMerbungBoundary){const t=p.geoJSON(e.dusunMerbungBoundary,{style:{color:e.colors.Merbung.solid,weight:3,fillOpacity:0,interactive:!1}}).addTo(e.map);e.layerControl.addOverlay(t,"Batas Dusun Merbung")}if(e.dusunKrapyakBoundary){const t=p.geoJSON(e.dusunKrapyakBoundary,{style:{color:e.colors["Krapyak & Perum"].solid,weight:3,fillOpacity:0,interactive:!1}}).addTo(e.map);e.layerControl.addOverlay(t,"Batas Dusun Krapyak")}}function k(){const t=e.categories.filter(a=>a.isActive).map(a=>a.value),n=e.searchTerm.toLowerCase().replace(/\s+/g,"");e.merbungLayer&&(e.map.removeLayer(e.merbungLayer),e.layerControl.removeLayer(e.merbungLayer)),e.krapyakPerumLayer&&(e.map.removeLayer(e.krapyakPerumLayer),e.layerControl.removeLayer(e.krapyakPerumLayer)),e.visibleLayers={};const r=document.getElementById("search-result-container");r.innerHTML="";const o=document.createDocumentFragment(),u=(a,d,m,v,s)=>{const i=a.filter(c=>{const y=c.properties.RT_RW?.toLowerCase().replace(/\s+/g,"")||"",b=c.properties.RW;return t.includes(b)&&(y.includes(n)||`rt${c.properties.RT}`.includes(n)||`rw${b}`.includes(n))});if(i.length===0)return;const l=c=>(y,b)=>{const{RT_RW:h}=y.properties;e.visibleLayers[h]=b,b.bindPopup(P(y.properties,c),{className:"marker-popup"}),b.on({mouseover:L=>L.target.setStyle({fillColor:m.hover,weight:2.5}),mouseout:L=>L.target.setStyle({fillColor:m.base,weight:2})});const f=document.createElement("button");f.type="button",f.className="btn btn-text btn-primary justify-start h-fit rounded-md text-left card-side max-w-sm",f.innerHTML=`
        <div class="p-2 gap-0 text-left">
          <div class="text-xs flex flex-row gap-2 items-center text-left">
          <span class="icon-[tabler--building-community] inline-block align-middle size-8 mr-1"></span>
          <div class="">
            <h5 class="relative wrap-break-word mb-1 text-base text-base-content font-bold">${h}</h5>
            <span class="badge mb-1 badge-outline badge-sm badge-primary">${c}</span>
          </div>
          </div>
        </div>`,f.addEventListener("click",()=>K(h)),o.appendChild(f);const B=document.createElement("hr");B.className="text-base-content/20",o.appendChild(B)},g=p.geoJSON({type:"FeatureCollection",features:i},{style:{color:m.hover,weight:2,fillOpacity:1,fillColor:m.base},onEachFeature:l(v)}).addTo(e.map);e[d]=g,e.layerControl.addOverlay(g,s)};u(e.allMerbungData.features,"merbungLayer",e.colors.Merbung,"Dusun Merbung","Wilayah RT Merbung"),u([...e.allKrapyakData.features,...e.allPerumData.features],"krapyakPerumLayer",e.colors["Krapyak & Perum"],"Dusun Krapyak & Perum","Wilayah RT Krapyak & Perum"),r.appendChild(o)}function E(){const t=document.getElementById("categoryFilter"),n=e.categories.every(d=>d.isActive);let a=`
    <button data-action="${n?"none":"all"}" class="badge shrink-0 badge-lg cursor-pointer relative badge-primary mr-2 rounded-full">
      <span class="${n?"icon-[tabler--trash]":"icon-[tabler--check]"} size-4.5"></span>
      ${n?"Hapus Filter":"Pilih Semua"}
      <div class="border-l-2 border-base-content h-5 absolute right-0 translate-x-2.5"></div>
    </button>`;a+=e.categories.map(d=>{const m=d.isActive?"badge-primary":"badge-outline";return`<button data-category="${d.name}" class="badge shrink-0 badge-lg cursor-pointer w-fit ${m} rounded-full">${d.name}</button>`}).join(""),t.innerHTML=a}function S(){const t=document.getElementById("search-admin"),n=document.getElementById("clear-search-button"),r=document.getElementById("search-icon"),o=document.getElementById("categoryFilter"),u=document.getElementById("complain-form-element"),a=document.getElementById("form-complain-status"),d=document.getElementById("region_name");n.addEventListener("click",()=>{t.value="",e.searchTerm="",k(),r.dataset.icon="search"}),t.addEventListener("input",s=>{e.searchTerm=s.target.value,r.dataset.icon=e.searchTerm?"x":"search",clearTimeout(e.searchTimeout),e.searchTimeout=setTimeout(k,400)}),o.addEventListener("click",s=>{const i=s.target.closest("button");if(!i)return;const{category:l,action:g}=i.dataset;if(g){const c=g==="all";e.categories.forEach(y=>y.isActive=c)}else if(l){const c=e.categories.find(y=>y.name===l);c&&(c.isActive=!c.isActive)}E(),k()}),HSOverlay.autoInit();const{element:m}=HSOverlay.getInstance("#form-complain",!0);m.on("close",M),window.openComplainForm=(s,i)=>{setTimeout(()=>{const l=`
        <option selected>RT ${s.RT} / RW ${s.RW}</option>
        <option>RW ${s.RW}</option>
        <option>${i}</option>
      `;d.innerHTML=l},100),a.innerHTML="",m.open()},u.addEventListener("submit",v);async function v(s){const i=document.getElementById("form-complain-submit-button");s.preventDefault();const l=new FormData(s.target);l.get;const g={name:l.get("name")||"",email:l.get("email")||"",phoneNumber:l.get("phone")||"",complainee:l.get("region_name"),subject:l.get("complaint_subject"),complaintText:l.get("complaint_text")};if(!g.subject){a.className="text-error",a.innerHTML="Judul Keluhan tidak boleh kosong!";return}if(!g.complaintText){a.className="text-error",a.innerHTML="Isi Keluhan tidak boleh kosong!";return}i.disabled=!0,i.innerHTML="Mengirim",await w()?(a.className="text-success",a.innerHTML=`
        Keluhan berhasil dikirim!
        <div class="radial-progress auto-close-modal text-primary" style="--value:100; --size:1rem; --thickness:3px" role="progressbar" aria-label="Radial Progress"></div>`,M(),setTimeout(()=>{m.close(),a.innerHTML="",i.disabled=!1},3e3)):a.innerHTML="Gagal mengirim keluhan. Silakan coba lagi.",i.innerHTML="Kirim"}}function K(t){const n=e.visibleLayers[t];n&&(e.map.flyToBounds(n.getBounds(),{paddingTopLeft:[0,200]}),n.openPopup(),document.getElementById("close-search")?.click())}function C(){const t=document.getElementById("legend-content");let n=`<div class="p-2 space-y-1">
    <div class="flex items-center gap-2">
      <div style="background-color: ${e.colors.Merbung.base}; border: 2px solid ${e.colors.Merbung.hover};" class="size-4 rounded"></div>
      <span>Merbung</span>
    </div>
    <div class="flex items-center gap-2">
      <div style="background-color: ${e.colors["Krapyak & Perum"].base}; border: 2px solid ${e.colors["Krapyak & Perum"].hover};" class="size-4 rounded"></div>
      <span>Krapyak & Perum</span>
    </div>
    <div class="flex items-center gap-2">
      <div style="background-color: red;" class="h-1 w-4 rounded"></div>
      <span>Batas Desa</span>
    </div>
  </div>`;t.innerHTML=n}function $(){const{routing:t}=e;document.getElementById("routeToggleBtn").addEventListener("click",()=>{const r=document.getElementById("routingPanel");r.style.display=r.style.display==="none"||r.style.display===""?"block":"none"}),document.getElementById("initalPointBtn").addEventListener("click",()=>{t.selectingStart=!0,t.selectingEnd=!1,alert("Klik di peta untuk titik awal")}),document.getElementById("endPointBtn").addEventListener("click",()=>{t.selectingEnd=!0,t.selectingStart=!1,alert("Klik di peta untuk titik tujuan")}),document.getElementById("initalResetBtn").addEventListener("click",()=>{t.startMarker&&e.map.removeLayer(t.startMarker),t.startMarker=null,t.startPoint=null}),document.getElementById("endResetBtn").addEventListener("click",()=>{t.endMarker&&e.map.removeLayer(t.endMarker),t.endMarker=null,t.endPoint=null}),document.getElementById("findRouteBtn").addEventListener("click",n),e.map.on("click",r=>{t.selectingStart?(t.startMarker&&e.map.removeLayer(t.startMarker),t.startPoint=r.latlng,t.startMarker=p.marker(t.startPoint,{icon:t.markericon}).addTo(e.map),t.selectingStart=!1):t.selectingEnd&&(t.endMarker&&e.map.removeLayer(t.endMarker),t.endPoint=r.latlng,t.endMarker=p.marker(t.endPoint,{icon:t.markericon}).addTo(e.map),t.selectingEnd=!1)});function n(){if(!t.startPoint||!t.endPoint){alert("Tentukan titik awal dan tujuan.");return}t.control&&e.map.removeControl(t.control),t.control=p.Routing.control({waypoints:[t.startPoint,t.endPoint],lineOptions:{styles:[{color:"blue",weight:5,opacity:.8}]},routeWhileDragging:!1,createMarker:()=>null}).addTo(e.map),t.control.on("routesfound",r=>{const{totalTime:o,totalDistance:u}=r.routes[0].summary,a=Math.round(o/60),d=(u/1e3).toFixed(2);document.getElementById("routeInfo").innerText=`Durasi: ${a} menit | Jarak: ${d} km`})}}document.addEventListener("DOMContentLoaded",R);
